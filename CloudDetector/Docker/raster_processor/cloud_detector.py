import argparse
import os

from grass_session import Session
from grass.script import core as gcore
from grass.pygrass.modules.shortcuts import general as g
from grass.pygrass.modules.shortcuts import raster as r

from mapcalc_nnet import MapcalcPerceptron
from utils import uniq_name


def band_name(raster, band):
    bands = {
        "B1": 1, "B2": 2, "B3": 3, 
        "B4": 4, "B5": 5, "B6": 6, 
        "B7": 7, "B8": 8, "B8A": 9, 
        "B9": 10,"B10": 11, "B11": 12,
        "B12": 13,
        "QA10": 14, "QA20": 15, "QA60": 16
    }
    return "{r}.{b}".format(r=raster, b=bands[band])


class CloudDetector:
    def __init__(self):
        self.w1 = [
            [2.956283688545227051e-01,-2.776691675186157227e+00,-2.803474426269531250e+00,-3.178660571575164795e-02,1.283154934644699097e-01,7.584244608879089355e-01,1.938914954662322998e-01,-3.809522092342376709e-02,6.807017326354980469e-01,-4.807073250412940979e-02,4.219933450222015381e-01,-1.376907825469970703e+00,-4.109185695648193359e+00,1.059966325759887695e+00,1.498883366584777832e+00,1.182978898286819458e-01,2.872016429901123047e-01,2.082682132720947266e+00,8.386415988206863403e-02,-3.115255199372768402e-02,-7.501184940338134766e-01,4.151443839073181152e-01,7.947779446840286255e-02,8.327477574348449707e-01,1.327423453330993652e-01,4.970518350601196289e-01,5.124890208244323730e-01,8.082872629165649414e-01,-3.983609974384307861e-01,-2.502110004425048828e-01],
            [2.901251912117004395e-01,3.730339705944061279e-01,-5.312851816415786743e-02,-6.524602323770523071e-02,8.385747671127319336e-02,3.863364756107330322e-01,2.940022014081478119e-02,-1.329190097749233246e-03,-2.890085220336914062e+00,3.486266136169433594e-01,-2.639471925795078278e-02,1.292640529572963715e-02,2.369751594960689545e-02,-1.116875261068344116e-01,-1.255584321916103363e-02,-1.533204019069671631e-01,3.226944059133529663e-02,1.800673753023147583e-01,1.036304906010627747e-01,2.949606999754905701e-02,-1.071887090802192688e-01,7.864145934581756592e-02,2.371706254780292511e-02,9.701679646968841553e-02,-2.087821006774902344e+00,6.231337413191795349e-02,1.344591826200485229e-01,7.028948664665222168e-01,3.928071260452270508e-01,-6.733575463294982910e-02],
            [-7.688895612955093384e-02,1.807965785264968872e-01,-2.925971522927284241e-02,9.754257202148437500e-01,7.384511828422546387e-02,-3.081241846084594727e+00,2.001950442790985107e-01,5.263952016830444336e-01,-1.476074308156967163e-01,2.743069827556610107e-01,9.422407299280166626e-02,6.676151752471923828e-01,-7.501397281885147095e-03,4.101781174540519714e-02,6.491049379110336304e-02,2.414465397596359253e-01,1.092648655176162720e-01,-2.944564223289489746e-01,9.154386818408966064e-02,6.373693235218524933e-03,-9.892486035823822021e-02,2.965682186186313629e-03,4.929701332002878189e-03,5.177718028426170349e-02,2.711343467235565186e-01,1.611865125596523285e-02,-9.955732524394989014e-02,-1.757191270589828491e-01,-4.064853489398956299e-01,-3.953414503484964371e-03],
            [9.138947934843599796e-04,7.094096392393112183e-02,-2.949748001992702484e-02,-4.067613780498504639e-01,9.865704923868179321e-03,-3.787988424301147461e-02,-1.596550643444061279e-02,-5.143929123878479004e-01,-3.363702818751335144e-02,3.377079069614410400e-01,3.908406943082809448e-02,-3.036438524723052979e-01,3.741395194083452225e-04,8.062960207462310791e-02,-5.449730530381202698e-02,1.496058423072099686e-02,8.201882243156433105e-02,-8.311679586768150330e-03,1.088376119732856750e-01,1.825011894106864929e-02,1.210645079612731934e+00,-2.522991783916950226e-02,3.016593120992183685e-02,-1.355998963117599487e-01,4.863304272294044495e-02,6.706567853689193726e-02,-1.339439511299133301e+00,-1.774296313524246216e-01,1.518246382474899292e-01,2.779811993241310120e-02],
            [-4.181263595819473267e-02,-1.819560490548610687e-02,2.441414399072527885e-03,-3.770006075501441956e-02,-6.289044395089149475e-03,4.827977716922760010e-02,8.361750096082687378e-02,3.146465420722961426e-01,5.209939926862716675e-02,3.804942667484283447e-01,1.523640821687877178e-03,5.712167918682098389e-02,4.475083667784929276e-03,-4.703041166067123413e-02,7.879389822483062744e-02,-1.824039936065673828e+00,3.993475809693336487e-02,1.950341858901083469e-03,3.393040969967842102e-02,-5.696760490536689758e-03,1.867376966401934624e-03,8.005054667592048645e-03,-1.632294268347322941e-03,-4.412267506122589111e-01,2.522533200681209564e-02,1.474153101444244385e-01,2.367768622934818268e-02,1.111963763833045959e-01,-1.758320093154907227e+00,4.335825890302658081e-02],
            [1.629963964223861694e-01,3.529522195458412170e-02,5.541015788912773132e-02,-6.042405962944030762e-01,-3.731523873284459114e-03,6.785583496093750000e-02,1.842649877071380615e-01,-1.713700890541076660e-01,-5.600472167134284973e-02,-2.155886292457580566e-01,8.873116970062255859e-02,-3.513984009623527527e-02,1.665662974119186401e-02,-1.357174962759017944e-01,5.819447711110115051e-02,6.099076271057128906e-01,4.576930403709411621e-02,5.671985074877738953e-02,-2.581566095352172852e+00,-5.020965822041034698e-03,-9.238879196345806122e-03,2.542249299585819244e-02,9.308680891990661621e-04,1.335650384426116943e-01,6.181048750877380371e-01,2.274615131318569183e-02,2.721296437084674835e-02,3.049827516078948975e-01,-7.251924276351928711e-02,5.344791337847709656e-03],
            [3.319574594497680664e-01,-1.571826040744781494e-01,1.421341001987457275e-01,1.423308402299880981e-01,-3.931369259953498840e-02,1.156656444072723389e-01,1.033867523074150085e-01,3.976241350173950195e-01,4.355289274826645851e-05,1.414387822151184082e-01,-3.464818477630615234e+00,3.090861439704895020e-01,-5.373547319322824478e-03,-2.886448800563812256e-01,-6.919052600860595703e-01,2.445891126990318298e-02,1.233400106430053711e-01,2.859873473644256592e-01,7.990252226591110229e-02,4.818053543567657471e-02,2.805338241159915924e-02,-2.100773572921752930e+00,4.895263537764549255e-02,1.969300657510757446e-01,-2.639719545841217041e-01,-1.258724629878997803e-01,-9.781226515769958496e-02,3.478898853063583374e-02,-6.624237447977066040e-02,3.193450272083282471e-01],
            [-4.852364540100097656e+00,2.644784562289714813e-02,8.544249087572097778e-02,-7.740136235952377319e-02,-4.446132853627204895e-02,5.741744115948677063e-02,3.382905721664428711e-01,-9.160576820373535156e+00,2.705881558358669281e-02,-1.133223157376050949e-02,-5.359022691845893860e-02,2.055652439594268799e-03,3.402581065893173218e-02,-9.377745628356933594e+00,-3.609577193856239319e-03,-6.962577998638153076e-02,7.895110547542572021e-02,-1.532808095216751099e-01,-4.418809339404106140e-02,2.949810028076171875e+00,5.370673537254333496e-02,-5.165157373994588852e-03,-3.349338949192315340e-04,-1.638869643211364746e-01,-1.174851953983306885e-01,4.629506915807723999e-02,-2.011709287762641907e-02,-3.090930543839931488e-02,6.024638563394546509e-02,-4.950297355651855469e+00],
            [-1.756443083286285400e-02,1.323122531175613403e-01,-1.289502624422311783e-02,-1.307265907526016235e-01,2.197541713714599609e+00,1.645336747169494629e-01,5.030534863471984863e-01,-5.924597382545471191e-03,1.840735785663127899e-02,-2.465372383594512939e-01,-3.528915345668792725e-02,-2.992740646004676819e-02,1.471631973981857300e-02,-3.692854195833206177e-02,-7.097441237419843674e-03,7.063197344541549683e-02,-1.667483896017074585e-01,-8.722651749849319458e-02,1.044661328196525574e-01,-1.311184316873550415e-01,-5.987080931663513184e-02,-7.059068977832794189e-02,-3.454082489013671875e+00,6.075098179280757904e-03,-4.432157874107360840e-01,-2.914412915706634521e-01,3.513567894697189331e-02,-4.016702473163604736e-01,5.679017677903175354e-02,-9.682480245828628540e-03],
            [8.368952572345733643e-02,5.671321973204612732e-02,1.180914118885993958e-01,-2.574961073696613312e-02,-5.698261037468910217e-02,6.997419148683547974e-02,-2.045957371592521667e-02,6.327751278877258301e-02,9.047630243003368378e-03,1.483671069145202637e-01,2.084478363394737244e-02,-2.125629782676696777e-02,-7.155682891607284546e-02,1.031591072678565979e-01,3.317903280258178711e-01,3.419239446520805359e-02,-4.658064842224121094e+00,-4.310462251305580139e-02,6.516155600547790527e-02,-6.932433228939771652e-03,-7.202532887458801270e-02,1.213068794459104538e-02,6.088119000196456909e-02,9.993715584278106689e-02,9.045515209436416626e-02,-1.473837494850158691e+00,-2.274983562529087067e-03,-7.490298245102167130e-03,5.268476158380508423e-02,-1.713617563247680664e+00]
        ]
        self.w2 = [
            [3.338142335414886475e-01,9.699271917343139648e-01,-3.496745526790618896e-01,-5.421534776687622070e-01,4.585957229137420654e-01,2.938315868377685547e-01,1.139044240117073059e-01,-4.748415946960449219e-02,5.618312358856201172e-01,-5.818823575973510742e-01,-2.910634577274322510e-01,1.839786320924758911e-01,9.687930345535278320e-01,-2.273852586746215820e+00,-7.869135141372680664e-01,-3.511620759963989258e-01,2.077955901622772217e-01,-1.866219758987426758e+00,-6.884543299674987793e-01,-6.501216888427734375e-01,3.202924132347106934e-01,5.197955965995788574e-01,-1.023717164993286133e+00,1.688467711210250854e-02,2.389667034149169922e-01,-2.062006235122680664e+00,-4.487325847148895264e-01,2.307808548212051392e-01,-2.021263122558593750e+00,-7.468626135960221291e-04,1.072926670312881470e-01,-2.992139756679534912e-01,6.788101792335510254e-01,1.108319520950317383e+00,6.285000443458557129e-01,4.731017351150512695e-01,3.503583669662475586e-01,-4.014935970306396484e+00,-1.268642425537109375e+00,-1.899681687355041504e+00],
            [-2.137190997600555420e-01,1.711064726114273071e-01,7.645171880722045898e-01,-2.687093257904052734e+00,-2.361904978752136230e-01,-7.581611275672912598e-01,-9.580696374177932739e-02,-5.708922147750854492e-01,-7.225280404090881348e-01,1.473588049411773682e-01,-4.307225644588470459e-01,-1.476152062416076660e+00,-1.219667047262191772e-01,-8.560258150100708008e-01,1.121953409165143967e-02,-5.041752457618713379e-01,-2.293804138898849487e-01,5.120025873184204102e-01,-7.852831482887268066e-02,6.170534491539001465e-01,9.554131627082824707e-01,2.609190046787261963e-01,-9.585024118423461914e-01,-1.472400546073913574e+00,-1.184987902641296387e+00,-8.530963659286499023e-01,-2.503542788326740265e-02,-1.130973100662231445e+00,2.123643904924392700e-01,-6.894912719726562500e-01,-4.834341704845428467e-01,-2.147500216960906982e-02,-6.649813801050186157e-02,1.980531215667724609e-01,-1.553332567214965820e+00,-1.171826601028442383e+00,-7.535324692726135254e-01,3.969930857419967651e-02,4.144957363605499268e-01,-1.909669399261474609e+00],
            [-1.558563411235809326e-01,-1.066391542553901672e-01,-9.788355827331542969e-01,-1.787386178970336914e+00,-2.614487409591674805e-01,-6.828461289405822754e-01,-1.810168474912643433e-01,-2.383360117673873901e-01,-5.559122934937477112e-02,2.719015777111053467e-01,-2.477813512086868286e-02,-5.364030599594116211e-01,-6.248602867126464844e-01,9.492144584655761719e-01,5.028857588768005371e-01,-1.805991679430007935e-01,3.475644886493682861e-01,5.779926776885986328e-01,1.813868582248687744e-01,-3.456636369228363037e-01,1.197398304939270020e+00,-4.608770012855529785e-01,3.919925093650817871e-01,-3.350588977336883545e-01,-1.568851947784423828e+00,-1.958591222763061523e+00,3.376011271029710770e-03,-2.865931391716003418e-01,-2.181922048330307007e-01,7.409814000129699707e-01,7.110532522201538086e-01,-8.829474449157714844e-02,-6.028103828430175781e-01,2.893135249614715576e-01,-1.818971514701843262e+00,6.361475586891174316e-01,-3.461460173130035400e-01,5.977205634117126465e-01,-7.438005805015563965e-01,-1.936763525009155273e+00],
            [1.828170269727706909e-01,3.098495863378047943e-02,-7.633804529905319214e-02,1.200650930404663086e-01,4.476122260093688965e-01,-2.227777689695358276e-01,-3.257287144660949707e-01,1.141425818204879761e-01,2.158623188734054565e-03,1.316952109336853027e-01,-1.483329683542251587e-01,3.060579299926757812e-01,-1.740558981895446777e+00,5.688920021057128906e-01,-4.229207932949066162e-01,3.117798268795013428e-01,2.446592152118682861e-01,1.903760284185409546e-01,1.255807001143693924e-03,3.263651207089424133e-02,-4.062850773334503174e-02,-4.760515093803405762e-01,4.065590798854827881e-01,1.040443331003189087e-01,-7.905597984790802002e-02,7.707757949829101562e-01,1.093416929244995117e+00,2.115772068500518799e-01,-5.807826519012451172e-01,5.758890509605407715e-02,-1.175267219543457031e+00,-2.298389822244644165e-01,8.478716611862182617e-01,1.028517819941043854e-02,4.979905672371387482e-03,5.885320901870727539e-01,6.983422487974166870e-02,-1.843131184577941895e-01,-6.238197162747383118e-02,4.246441125869750977e-01],
            [-4.906720638275146484e+00,-2.296004593372344971e-01,-1.896858215332031250e-01,2.490353882312774658e-01,3.495211899280548096e-01,2.374901771545410156e-01,5.592890456318855286e-02,-1.720441430807113647e-01,-2.287854440510272980e-02,-7.428249716758728027e-02,5.685612931847572327e-02,1.896359622478485107e-01,-2.266231738030910492e-02,3.973678946495056152e-01,7.762683629989624023e-01,-1.501579880714416504e-01,-1.330687999725341797e-01,-1.110506523400545120e-02,-4.600305557250976562e+00,1.876245588064193726e-01,-1.516393125057220459e-01,3.417723178863525391e-01,-5.581050395965576172e+00,-5.712128430604934692e-02,3.360543549060821533e-01,1.634792797267436981e-02,1.618593744933605194e-02,-2.454174011945724487e-01,-1.550199389457702637e-01,-4.421877488493919373e-02,-1.426943987607955933e-01,-1.257868856191635132e-01,-3.341553211212158203e-01,1.955885589122772217e-01,1.755253225564956665e-01,2.872512042522430420e-01,6.863668560981750488e-02,-4.929454624652862549e-01,5.378297716379165649e-02,-5.925478458404541016e+00],
            [-1.288912773132324219e+00,-4.812251031398773193e-01,-5.404367446899414062e-01,1.516335755586624146e-01,5.017722845077514648e-01,-1.303249001502990723e-01,-1.835087537765502930e-01,-2.391866594552993774e-02,-7.758809626102447510e-02,-9.293916076421737671e-02,4.866507649421691895e-01,-2.133672982454299927e-01,1.016612172126770020e+00,2.150343209505081177e-01,-2.431407570838928223e-01,9.618071466684341431e-02,3.777611255645751953e-02,8.175434544682502747e-03,-8.540347218513488770e-02,2.309823483228683472e-01,1.170136332511901855e-01,-2.453156948089599609e+00,-2.294402010738849640e-02,1.583935737609863281e+00,-2.861564755439758301e-01,3.097140789031982422e-01,-7.582921385765075684e-01,4.666350483894348145e-01,-5.228804051876068115e-02,3.979833796620368958e-02,1.904736399650573730e+00,-1.638203561305999756e-01,4.216437041759490967e-01,5.320808291435241699e-01,1.919315159320831299e-01,-3.192186057567596436e-01,-4.024016857147216797e-02,-3.325206041336059570e-02,2.860884070396423340e-01,-1.331861168146133423e-01],
            [4.224309325218200684e-01,-5.750215649604797363e-01,5.542159080505371094e-01,1.935037970542907715e-02,7.075226902961730957e-01,2.286814749240875244e-01,5.048513039946556091e-02,3.034994304180145264e-01,3.254198133945465088e-01,3.894184827804565430e-01,-3.430626988410949707e-01,-3.487426936626434326e-01,-5.875051021575927734e-01,2.557155191898345947e-01,3.671909272670745850e-01,-2.246854156255722046e-01,-1.733282357454299927e-01,1.794860959053039551e-01,-2.678196132183074951e-01,2.668249607086181641e-01,-6.529546976089477539e-01,4.012047946453094482e-01,-4.101385474205017090e-01,1.858618110418319702e-01,3.367785513401031494e-01,2.778684794902801514e-01,-9.705609641969203949e-03,-7.252543568611145020e-01,2.516410052776336670e-01,1.091804280877113342e-01,-6.804447174072265625e-01,-9.128876775503158569e-02,3.587812483310699463e-01,8.280999660491943359e-01,2.721993327140808105e-01,-6.080869436264038086e-01,7.000737786293029785e-01,-2.854564487934112549e-01,3.319043293595314026e-02,-3.079164773225784302e-02],
            [4.423650801181793213e-01,-5.325310230255126953e-01,5.493960976600646973e-01,-3.467293083667755127e-01,-1.092653125524520874e-01,-2.140916734933853149e-01,-1.422250568866729736e-01,-7.375720143318176270e-01,-2.518145442008972168e-01,-7.455679774284362793e-01,-1.352141141891479492e+00,1.233897060155868530e-01,1.339681267738342285e+00,1.964281201362609863e-01,6.214991211891174316e-01,-3.156644105911254883e-02,1.027947902679443359e+00,-1.090861082077026367e+00,-1.928040981292724609e+00,-6.388804316520690918e-01,-4.281838536262512207e-01,-1.936893701553344727e+00,-4.773287475109100342e-01,1.066498517990112305e+00,1.031905636191368103e-01,-1.415325284004211426e+00,-1.955072999000549316e+00,6.983897686004638672e-01,-5.302849411964416504e-01,4.677248895168304443e-01,1.854646950960159302e-01,4.136454686522483826e-02,6.357766389846801758e-01,-1.463701844215393066e+00,5.337297916412353516e-01,-1.124297022819519043e+00,-5.304278731346130371e-01,-7.878177165985107422e-01,-1.121683478355407715e+00,-8.960087895393371582e-01],
            [-1.223285913467407227e+00,6.486226916313171387e-01,-8.627375960350036621e-02,1.160104870796203613e-01,-1.883464157581329346e-01,7.624107599258422852e-01,-1.612743884325027466e-01,-2.462357759475708008e+00,-2.036775112152099609e+00,-1.380350999534130096e-02,-1.583287954330444336e+00,1.511705994606018066e+00,-1.829491376876831055e+00,-2.045491933822631836e+00,2.017302751541137695e+00,-6.232656240463256836e-01,1.881092339754104614e-01,1.457294672727584839e-01,-7.473712414503097534e-02,-2.790299415588378906e+00,1.909226775169372559e-01,9.642099142074584961e-01,-2.234621495008468628e-01,1.808049380779266357e-01,2.165774852037429810e-01,3.572297841310501099e-02,9.659277200698852539e-01,-1.590951800346374512e+00,-1.145481169223785400e-01,1.513867527246475220e-01,-1.677459478378295898e-01,-7.507415860891342163e-02,-2.566295564174652100e-01,-2.257088422775268555e-01,-6.029465701431035995e-03,9.384248256683349609e-01,-1.462461799383163452e-01,2.921811044216156006e-01,-1.667232066392898560e-01,1.721672900021076202e-02],
            [7.275083065032958984e-01,-1.003500699996948242e+00,3.352248668670654297e-01,1.466326266527175903e-01,5.549017786979675293e-01,3.668119311332702637e-01,-3.323071599006652832e-01,5.262535810470581055e-01,4.156627953052520752e-01,-1.200289949774742126e-01,1.303553860634565353e-02,-1.020817160606384277e-01,-2.754672467708587646e-01,4.329354763031005859e-01,-5.210893750190734863e-01,2.328965216875076294e-01,9.921444952487945557e-02,-3.744982779026031494e-01,6.790441870689392090e-01,5.909952521324157715e-01,-5.209435820579528809e-01,9.728087186813354492e-01,4.373139441013336182e-01,-4.231663644313812256e-01,3.309337496757507324e-01,3.223925530910491943e-01,-1.554720401763916016e-01,2.744804322719573975e-01,5.246873497962951660e-01,-3.768562152981758118e-02,-5.326501131057739258e-01,1.191010922193527222e-01,2.385852932929992676e-01,-3.473928570747375488e-01,3.492733836174011230e-01,-8.236724734306335449e-01,4.465768039226531982e-01,-4.120687544345855713e-01,-3.643488883972167969e-01,2.402831614017486572e-01],
            [4.509859681129455566e-01,-6.243923306465148926e-01,3.776988089084625244e-01,9.012228250503540039e-01,4.363400042057037354e-01,9.743588417768478394e-02,-2.446466684341430664e-02,7.521653175354003906e-02,-1.020301699638366699e+00,-3.498969078063964844e-01,-2.212027788162231445e+00,-4.580377042293548584e-01,1.289671063423156738e+00,-1.095201373100280762e+00,-1.663278341293334961e+00,1.524015903472900391e+00,-1.160836406052112579e-02,1.522578120231628418e+00,-7.127449035644531250e+00,-4.568735659122467041e-01,-2.913755476474761963e-01,4.298722743988037109e-02,-3.548063337802886963e-01,-2.318672388792037964e-01,6.401594877243041992e-01,3.099850416183471680e-01,-3.605160474777221680e+00,-5.856758356094360352e-01,-2.620298624038696289e+00,-1.646354496479034424e-01,1.469679325819015503e-01,1.796244978904724121e-01,1.768319487571716309e+00,-8.125205636024475098e-01,5.211226344108581543e-01,-1.136983990669250488e+00,-3.365257978439331055e+00,1.808731317520141602e+00,1.545297980308532715e+00,-2.593684792518615723e-01],
            [2.410684823989868164e-01,-1.845174003392457962e-03,-4.788019880652427673e-02,5.422560125589370728e-02,2.727213501930236816e-02,1.247859746217727661e-01,1.130561009049415588e-01,-5.089445710182189941e-01,4.148949682712554932e-01,-1.807167232036590576e-01,2.414876371622085571e-01,3.395333886146545410e-01,-1.515185832977294922e-01,5.978434532880783081e-02,9.944447129964828491e-02,-7.525101304054260254e-02,2.110141366720199585e-01,2.790697515010833740e-01,-8.328653872013092041e-03,-9.947586059570312500e-01,-1.126009076833724976e-01,5.412555932998657227e-01,4.243935048580169678e-01,-4.185219705104827881e-01,-6.537331938743591309e-01,5.017630457878112793e-01,1.009193733334541321e-01,-1.475529193878173828e+00,3.668836653232574463e-01,4.058647453784942627e-01,-1.098907232284545898e+00,-2.040660381317138672e-01,-3.632874190807342529e-01,4.701504111289978027e-01,-1.490665823221206665e-01,7.253988385200500488e-01,-1.815912574529647827e-01,8.483471721410751343e-02,4.435003399848937988e-01,2.626387774944305420e-01],
            [1.609074324369430542e-01,2.360933572053909302e-01,-1.655548095703125000e+01,-1.951668709516525269e-01,-5.641840100288391113e-01,-4.797040939331054688e+00,-1.529383510351181030e-01,1.417704701423645020e+00,1.212042570114135742e-01,-9.707052230834960938e+00,4.296017438173294067e-02,6.399952173233032227e-01,3.794320523738861084e-01,1.962742358446121216e-01,4.124145507812500000e-01,2.705405950546264648e-01,2.288800030946731567e-01,-6.832189559936523438e-01,-2.825516760349273682e-01,5.585823059082031250e-01,9.887725114822387695e-01,-3.474566936492919922e-01,4.265815913677215576e-01,1.532502174377441406e+00,-2.989630937576293945e+00,-4.205739021301269531e+00,-5.832852050662040710e-02,1.761855244636535645e+00,-5.947701632976531982e-02,2.183597534894943237e-01,1.857755333185195923e-01,-2.774820327758789062e-01,9.167723059654235840e-01,-3.003308475017547607e-01,-9.240009307861328125e+00,5.227382779121398926e-01,-9.521912932395935059e-01,4.777845740318298340e-01,-1.930414289236068726e-01,1.115294694900512695e+00],
            [-1.371197700500488281e+00,-4.962753355503082275e-01,1.766158699989318848e+00,-1.478741765022277832e+00,-1.344984746538102627e-03,-1.063702344894409180e+00,3.900420665740966797e-02,-5.766757726669311523e-01,-1.249008655548095703e+00,-6.993268966674804688e+00,-6.778582572937011719e+00,-4.062334448099136353e-02,-2.979707002639770508e+00,6.221319437026977539e-01,-5.156372860074043274e-02,-2.304995357990264893e-01,9.451352357864379883e-01,-3.712530136108398438e+00,-2.862613201141357422e+00,-1.456910967826843262e+00,2.024730205535888672e+00,3.782623410224914551e-01,2.847888171672821045e-01,-2.000919342041015625e+00,-9.315862059593200684e-01,-2.482104778289794922e+00,-2.196421384811401367e+00,-4.928998649120330811e-01,-9.023348689079284668e-01,7.384394407272338867e-01,3.065744638442993164e-01,-2.561682835221290588e-02,7.563719749450683594e-01,-1.934152364730834961e+00,-1.969942450523376465e-01,-9.047717452049255371e-01,-6.496360898017883301e-02,-3.757311582565307617e+00,-1.459688663482666016e+00,-2.691698074340820312e+00],
            [2.833466231822967529e-01,6.646773219108581543e-01,4.538497701287269592e-02,2.960549294948577881e-01,7.571683526039123535e-01,5.008859634399414062e-01,-3.007622361183166504e-01,5.506103038787841797e-01,6.632313728332519531e-01,2.262030094861984253e-01,7.366336882114410400e-02,2.893635332584381104e-01,-4.727461636066436768e-01,5.296598076820373535e-01,-1.743836253881454468e-01,3.420849144458770752e-01,1.449291314929723740e-02,4.384265467524528503e-02,2.505347728729248047e-01,6.278758645057678223e-01,-4.081028103828430176e-01,1.422323733568191528e-01,-2.296658456325531006e-01,6.863623261451721191e-01,4.653846025466918945e-01,1.099495887756347656e-01,5.864909291267395020e-01,4.726087450981140137e-01,3.766995966434478760e-01,-3.241278529167175293e-01,-2.261453717947006226e-01,1.116534546017646790e-01,1.045477390289306641e+00,1.906651556491851807e-01,3.376147150993347168e-01,-3.506871461868286133e-01,2.015332281589508057e-01,-2.632053196430206299e-01,-2.578226327896118164e+00,6.637991070747375488e-01],
            [-5.327792763710021973e-01,3.507440984249114990e-01,-1.491596937179565430e+00,-1.064409241080284119e-01,-2.827119827270507812e-01,3.510567247867584229e-01,4.286423325538635254e-03,5.702102556824684143e-02,-1.667249053716659546e-01,-1.935702050104737282e-03,6.892540305852890015e-02,5.212460756301879883e-01,3.494430333375930786e-02,-3.951832354068756104e-01,-9.375116974115371704e-02,-6.235554218292236328e-01,-2.471332550048828125e-01,-4.464184641838073730e-01,1.151877939701080322e-01,-8.697088807821273804e-02,4.546692967414855957e-01,1.211490988731384277e+00,-6.379771232604980469e-02,-4.267449676990509033e-01,1.251431740820407867e-02,-3.473298549652099609e-01,3.099096715450286865e-01,3.465588092803955078e-01,-4.410815984010696411e-02,-2.501727640628814697e-01,1.713748835027217865e-02,-1.095035150647163391e-01,-3.166628479957580566e-01,-7.799775004386901855e-01,9.625005722045898438e-02,-1.066896677017211914e+00,-9.732937067747116089e-02,2.874475717544555664e-01,-1.083138808608055115e-01,-9.604120627045631409e-03],
            [-2.299195975065231323e-01,1.277637332677841187e-01,-1.974722623825073242e+00,-1.274740457534790039e+00,-2.637400865554809570e+00,-8.057959675788879395e-01,-2.258903980255126953e-01,1.591736376285552979e-01,-5.651176929473876953e+00,1.344384670257568359e+00,7.749314904212951660e-01,-7.280899524688720703e+00,-2.624271214008331299e-01,-1.571916341781616211e+00,6.650324463844299316e-01,-2.300793081521987915e-01,5.899732187390327454e-02,-7.845571637153625488e-02,2.046289145946502686e-01,-2.733025550842285156e-01,6.549892574548721313e-02,-8.463533222675323486e-02,2.317135930061340332e-01,-7.999999523162841797e-01,2.501277485862374306e-03,5.009288787841796875e-01,3.127624988555908203e-01,2.896631360054016113e-01,4.387352988123893738e-02,6.095217168331146240e-02,6.012238562107086182e-02,1.201320290565490723e-01,1.040915012359619141e+00,-6.974620223045349121e-01,1.448582291603088379e+00,-3.110970258712768555e-01,-2.298477411270141602e+00,2.932292595505714417e-02,1.685286164283752441e+00,-4.264760613441467285e-01],
            [6.607816219329833984e-01,-6.243970990180969238e-01,-2.389282733201980591e-01,5.273993611335754395e-01,3.721748888492584229e-01,3.539425879716873169e-02,-2.187874615192413330e-01,1.162034392356872559e+00,6.686928272247314453e-01,5.788443684577941895e-01,-1.311953365802764893e-01,-3.273686021566390991e-02,-2.496316432952880859e+00,3.254532814025878906e-01,-5.893918871879577637e-01,1.525439023971557617e-01,8.857469260692596436e-02,9.363685548305511475e-02,4.110473692417144775e-01,7.860414981842041016e-01,-8.923601508140563965e-01,6.923609972000122070e-01,1.660259813070297241e-01,-4.574262201786041260e-01,1.251749694347381592e-01,6.898800134658813477e-01,-6.985652446746826172e-02,6.105074882507324219e-01,-1.339022994041442871e+00,2.475697360932826996e-02,-3.305056691169738770e-01,-9.483965486288070679e-02,1.107389330863952637e+00,-4.142044782638549805e-01,3.358761966228485107e-01,-6.726194638758897781e-03,6.019330620765686035e-01,-1.516832590103149414e+00,-2.557565450668334961e+00,4.577859938144683838e-01],
            [-7.333465665578842163e-02,-3.563152313232421875e+00,-2.996619641780853271e-01,1.764747947454452515e-01,8.194968104362487793e-02,1.444750130176544189e-01,-2.122428268194198608e-01,5.066313743591308594e-01,-1.904670894145965576e-01,1.128390654921531677e-01,1.200520277023315430e+00,-2.927115678787231445e+00,3.043341934680938721e-01,-1.189293041825294495e-01,8.000296950340270996e-01,2.069910049438476562e+00,2.585873240604996681e-03,-2.016775846481323242e+00,-2.690644562244415283e-01,8.340331912040710449e-01,-1.359479874372482300e-01,-1.807948350906372070e-01,-6.467092037200927734e-02,1.934228986501693726e-01,5.503808334469795227e-02,5.522142052650451660e-01,1.833956837654113770e+00,-1.017558053135871887e-01,1.471272110939025879e-01,1.257043927907943726e-01,1.272619515657424927e-01,-2.428282797336578369e-01,2.373730540275573730e-01,2.151200920343399048e-02,7.936304062604904175e-02,-3.132436871528625488e-01,-6.436092406511306763e-02,1.614494323730468750e-01,-1.585270017385482788e-01,-1.336480258032679558e-03],
            [-4.769451450556516647e-03,2.149125784635543823e-01,1.994243711233139038e-01,7.524187117815017700e-02,-8.268003165721893311e-02,1.091360375285148621e-01,5.091956257820129395e-02,-9.879898279905319214e-02,7.379616051912307739e-02,-3.852882981300354004e-02,1.418679766356945038e-02,9.330654144287109375e-02,1.000491529703140259e-01,3.840605542063713074e-02,3.553559184074401855e-01,-7.684451341629028320e-02,-9.813929557800292969e+00,-1.217755898833274841e-01,-7.365039549767971039e-03,2.227330952882766724e-02,-3.044431842863559723e-02,7.653917372226715088e-02,-7.211955070495605469e+00,5.625564139336347580e-03,2.339600920677185059e-01,4.971946030855178833e-02,-8.024093508720397949e-02,3.339691460132598877e-02,-2.094721887260675430e-03,-8.898551940917968750e+00,2.014940790832042694e-02,-2.101183384656906128e-01,-3.720450103282928467e-01,9.873463213443756104e-02,1.072414591908454895e-01,6.615478545427322388e-02,-5.685872584581375122e-02,5.504939705133438110e-02,-3.067534789443016052e-02,-1.281457394361495972e-02],
            [2.370160520076751709e-01,-1.704144954681396484e+00,5.303139686584472656e-01,-1.038277074694633484e-01,3.939318954944610596e-01,2.929087281227111816e-01,-1.975805014371871948e-01,-9.791978001594543457e-01,2.294019311666488647e-01,2.141057699918746948e-02,1.987550258636474609e-01,4.396136999130249023e-01,-3.120143115520477295e-01,3.338930308818817139e-01,-1.717925369739532471e-01,-4.335657358169555664e-01,1.917778849601745605e-01,1.629202216863632202e-01,1.047103106975555420e-01,-2.518838644027709961e-01,-4.028478264808654785e-01,-1.948271989822387695e-01,2.779001891613006592e-01,1.793117225170135498e-01,2.048959434032440186e-01,1.596033722162246704e-01,-6.501012248918414116e-04,-1.951764672994613647e-01,1.028818711638450623e-01,2.055715769529342651e-01,-2.343729883432388306e-01,-3.447417914867401123e-02,1.942505091428756714e-01,-1.046589374542236328e+00,-2.069168835878372192e-01,5.092065930366516113e-01,8.010234683752059937e-02,-6.220562756061553955e-02,3.731614649295806885e-01,-1.464673578739166260e-01],
            [6.199418902397155762e-01,5.369644761085510254e-01,-5.459679365158081055e-01,1.955239772796630859e+00,2.118945717811584473e-01,1.366457641124725342e-01,1.293292045593261719e-01,3.051367402076721191e-01,2.204904854297637939e-01,1.664099097251892090e+00,-4.161852300167083740e-01,1.385397613048553467e-01,-1.516531705856323242e-01,8.333070874214172363e-01,6.332568526268005371e-01,-2.209881246089935303e-01,6.006443500518798828e-02,1.374433636665344238e+00,-8.396644145250320435e-02,1.499022006988525391e+00,-9.221310913562774658e-02,-2.029985189437866211e-01,-7.309407591819763184e-01,-7.159215211868286133e-01,1.607459306716918945e+00,1.065426349639892578e+00,7.831832766532897949e-02,-5.627079606056213379e-01,-1.320387601852416992e+00,1.465306431055068970e-01,-4.397931322455406189e-02,-2.548818290233612061e-01,1.436554193496704102e-01,3.860490620136260986e-01,-1.808211803436279297e+00,-8.789950013160705566e-01,-1.797021031379699707e+00,3.580514192581176758e-01,7.667173743247985840e-01,1.549541831016540527e+00],
            [-5.977084040641784668e-01,-3.279808461666107178e-01,-3.810050487518310547e-01,-4.709646105766296387e-03,-2.839965820312500000e+00,-3.717167973518371582e-01,1.964258551597595215e-01,-5.666280746459960938e+00,-1.973016560077667236e-01,-9.082420915365219116e-02,1.481243371963500977e-01,2.409123629331588745e-01,-2.502564787864685059e-01,1.652340143918991089e-01,-3.877250254154205322e-01,-1.026180237531661987e-01,6.290944218635559082e-01,5.023658275604248047e-01,-6.126244664192199707e-01,-5.675389766693115234e-01,-1.270338147878646851e-01,-2.845714092254638672e-01,-1.008303463459014893e-01,2.962381839752197266e-01,-1.185189008712768555e+00,-1.635271191596984863e+00,1.475247144699096680e-01,1.882468909025192261e-01,-7.471239089965820312e+00,8.219327926635742188e-01,2.106765061616897583e-01,3.190695866942405701e-02,-1.349320411682128906e+00,2.572541475296020508e+00,-2.020845860242843628e-01,1.739039868116378784e-01,-1.978250384330749512e+00,-7.328113555908203125e+00,1.031707897782325745e-01,5.322507619857788086e-01],
            [1.827480792999267578e-01,8.148971796035766602e-01,2.435607314109802246e-01,3.064913153648376465e-01,4.162933230400085449e-01,6.170664429664611816e-01,-3.735913336277008057e-01,3.195449113845825195e-01,5.002721548080444336e-01,2.822093851864337921e-02,-3.501508533954620361e-01,3.257066607475280762e-01,-1.689610183238983154e-01,4.285005927085876465e-01,-1.264673769474029541e-01,-1.033207058906555176e+00,3.437122404575347900e-01,-2.774276137351989746e-01,4.486990869045257568e-01,-1.048628091812133789e-01,-5.476934313774108887e-01,5.681880116462707520e-01,3.060128092765808105e-01,1.468890160322189331e-01,3.868494629859924316e-01,2.754900157451629639e-01,3.873620927333831787e-01,5.747544765472412109e-01,1.764087378978729248e-01,3.348563015460968018e-01,-6.297332048416137695e-01,-3.184594511985778809e-01,3.969024419784545898e-01,-2.392243593931198120e-01,5.528515577316284180e-01,-9.629627317190170288e-02,7.080484032630920410e-01,-4.715164303779602051e-01,-3.743228018283843994e-01,4.226117730140686035e-01],
            [-6.812213659286499023e-01,-4.319187104701995850e-01,-4.704799950122833252e-01,3.634117078036069870e-03,2.336740344762802124e-01,1.529464125633239746e-01,-2.582430839538574219e-01,-8.923109173774719238e-01,1.335205197334289551e+00,-1.934576183557510376e-01,-6.167113780975341797e-01,-1.065716445446014404e-01,7.485474348068237305e-01,5.123338699340820312e-01,8.510340452194213867e-01,2.387766093015670776e-01,-3.166366815567016602e-01,-9.051141738891601562e-01,3.221237286925315857e-02,-4.474765658378601074e-01,1.305358111858367920e-01,-3.634515702724456787e-01,2.755426466464996338e-01,5.027402043342590332e-01,1.850896477699279785e-01,-7.896249890327453613e-01,-4.689607620239257812e-01,-1.793350726366043091e-01,2.682447433471679688e-01,-9.944055974483489990e-02,1.284256111830472946e-02,-9.911087155342102051e-02,4.516745209693908691e-01,1.570569425821304321e-01,5.650272220373153687e-02,-6.393101811408996582e-01,6.634162366390228271e-02,9.096198081970214844e-01,-6.593413949012756348e-01,-3.693022727966308594e-01],
            [-5.703427791595458984e-01,-1.164609342813491821e-01,6.945207118988037109e-01,-1.000211462378501892e-01,-5.324511528015136719e-01,3.246323764324188232e-01,-3.262116909027099609e-01,5.049810409545898438e-01,5.408793091773986816e-01,-2.413666397333145142e-01,4.413822591304779053e-01,1.177932135760784149e-04,-9.402503818273544312e-02,-8.680772781372070312e-01,9.645821154117584229e-02,4.312674999237060547e-01,2.825005352497100830e-01,1.042101606726646423e-01,-9.804571270942687988e-01,-1.399046331644058228e-01,1.587219983339309692e-01,2.081515267491340637e-02,-4.985455423593521118e-03,2.011968791484832764e-01,5.342409014701843262e-01,-1.850733906030654907e-01,5.054561495780944824e-01,5.934412032365798950e-02,-9.492661356925964355e-01,3.085731714963912964e-02,-1.663841307163238525e-02,-3.415078297257423401e-02,-8.030433058738708496e-01,-3.826141655445098877e-01,8.936785161495208740e-02,8.400934934616088867e-01,1.062142372131347656e+00,-1.743355870246887207e+00,4.744663536548614502e-01,2.451316565275192261e-01],
            [-1.494518369436264038e-01,1.035097837448120117e+00,3.727291226387023926e-01,4.066427424550056458e-02,-4.370624125003814697e-01,6.231374144554138184e-01,1.444780379533767700e-01,6.001326069235801697e-02,-2.299089580774307251e-01,-5.460616573691368103e-02,1.577381342649459839e-01,-5.414278507232666016e-01,1.432327777147293091e-01,2.294245213270187378e-01,-5.250168219208717346e-02,2.827440798282623291e-01,6.335734575986862183e-02,-8.353070169687271118e-02,4.308213293552398682e-01,1.921843439340591431e-01,7.778005599975585938e-01,-2.724866867065429688e-01,-3.201328814029693604e-01,5.433220267295837402e-01,4.178834855556488037e-01,-5.708685144782066345e-02,3.454302549362182617e-01,1.827894002199172974e-01,-1.598887443542480469e-01,-5.098970606923103333e-02,-2.396660596132278442e-01,-2.353365570306777954e-01,-8.444567322731018066e-01,5.008486509323120117e-01,9.154657274484634399e-02,5.043483376502990723e-01,1.335594803094863892e-01,1.931681334972381592e-01,6.455132365226745605e-01,-3.370998799800872803e-01],
            [6.291089653968811035e-01,-1.874916702508926392e-01,-4.107334017753601074e-01,3.502257764339447021e-01,2.811556756496429443e-01,5.566946268081665039e-01,-2.942038178443908691e-01,-2.452937066555023193e-01,4.174189269542694092e-01,7.680893409997224808e-03,-1.412344574928283691e-01,-4.090111553668975830e-01,-2.210357636213302612e-01,5.593102425336837769e-02,4.981170594692230225e-02,-2.290565669536590576e-01,1.079397574067115784e-01,-3.050308823585510254e-01,3.465946316719055176e-01,1.065793871879577637e+00,-1.689746975898742676e-01,1.122463941574096680e-01,5.636005997657775879e-01,3.364450633525848389e-01,2.991229891777038574e-01,-1.062280237674713135e-01,4.871419966220855713e-01,6.538942456245422363e-01,4.372932016849517822e-01,2.890205383300781250e-01,-1.757397055625915527e-01,-5.729223787784576416e-02,-1.947998628020286560e-02,5.101749300956726074e-01,9.048534631729125977e-01,-1.659407615661621094e+00,9.429637342691421509e-02,3.689944148063659668e-01,-5.099538564682006836e-01,3.786582648754119873e-01],
            [2.335462123155593872e-01,-5.483298897743225098e-01,4.480996727943420410e-01,1.991162747144699097e-01,1.536019444465637207e-01,-3.668791055679321289e-01,-2.434015274047851562e-01,-4.576682448387145996e-01,2.219107896089553833e-01,1.046035364270210266e-01,6.535908579826354980e-01,-7.922599911689758301e-01,-7.419796288013458252e-02,5.484832525253295898e-01,1.324488282203674316e+00,6.585042178630828857e-02,3.541024625301361084e-01,1.725763529539108276e-01,-4.625850915908813477e-01,-7.327391207218170166e-02,-7.701026201248168945e-01,1.522482395172119141e+00,2.023873925209045410e-01,2.940261363983154297e-01,-1.872312724590301514e-01,3.991647362709045410e-01,-5.521857142448425293e-01,-3.835509717464447021e-01,1.086033359169960022e-01,2.965544462203979492e-01,-1.677994132041931152e-01,-1.561397165060043335e-01,8.238846063613891602e-01,1.633861213922500610e-01,-8.736015856266021729e-02,5.634367465972900391e-01,1.386485397815704346e-01,-1.576395891606807709e-02,-1.230231821537017822e-01,2.242917865514755249e-01],
            [6.224210932850837708e-02,-2.938533388078212738e-02,1.769684627652168274e-02,-2.114354372024536133e-01,4.493685811758041382e-02,-3.164930641651153564e-01,-2.181264907121658325e-01,6.240876317024230957e-01,-1.654390931129455566e+00,-2.478862762451171875e+00,-1.594231963157653809e+00,-4.470023512840270996e-01,-4.247129857540130615e-01,8.870763778686523438e-01,4.303517639636993408e-01,3.010174930095672607e-01,3.166199102997779846e-02,-3.341891467571258545e-01,-1.186931058764457703e-01,5.132152438163757324e-01,2.368489742279052734e+00,5.495591089129447937e-02,-8.509056568145751953e-01,-4.995054304599761963e-01,-5.086276531219482422e-01,-2.017408132553100586e+00,-1.159517049789428711e+00,2.200639843940734863e-01,-2.721697807312011719e+00,5.208073556423187256e-02,1.676219552755355835e-01,-1.345423161983489990e-01,2.646850645542144775e-01,-9.165309369564056396e-02,-1.570398688316345215e+00,4.909636676311492920e-01,5.110328197479248047e-01,-1.278163790702819824e-01,-2.172102928161621094e+00,8.368571996688842773e-01]
        ]
        self.w3 = [
            [-7.019869089126586914e-01],
            [5.314840078353881836e-01],
            [-7.717252373695373535e-01],
            [6.220599412918090820e-01],
            [-4.014858901500701904e-01],
            [7.771994471549987793e-01],
            [-7.148933131247758865e-03],
            [7.283723950386047363e-01],
            [6.973500251770019531e-01],
            [1.750767469406127930e+00],
            [-6.440311074256896973e-01],
            [9.387000799179077148e-01],
            [6.366888880729675293e-01],
            [3.341546654701232910e-01],
            [-4.587130844593048096e-01],
            [9.054623842239379883e-01],
            [-1.169541001319885254e+00],
            [5.663573145866394043e-01],
            [-1.153564810752868652e+00],
            [5.320629477500915527e-01],
            [5.686813592910766602e-01],
            [3.809961974620819092e-01],
            [-1.433597564697265625e+00],
            [4.157128334045410156e-01],
            [4.071310758590698242e-01],
            [6.090964078903198242e-01],
            [-6.954759359359741211e-01],
            [3.150322139263153076e-01],
            [-1.242325663566589355e+00],
            [-5.804176330566406250e-01],
            [-3.127711296081542969e+00],
            [-3.012351095676422119e-01],
            [-3.649061322212219238e-01],
            [2.496839910745620728e-01],
            [8.188121318817138672e-01],
            [-4.301255345344543457e-01],
            [-6.645433306694030762e-01],
            [-1.100604891777038574e+00],
            [7.800009846687316895e-01],
            [1.644459962844848633e+00]
        ]

        self.b1 = [
            4.140404760837554932e-01,
            7.699263691902160645e-01,
            7.760860919952392578e-01,
            6.270410120487213135e-02,
            -8.739993572235107422e-01,
            7.781342864036560059e-01,
            -4.034744501113891602e-01,
            7.717196643352508545e-02,
            8.046287298202514648e-01,
            -2.313241213560104370e-01,
            8.173631429672241211e-01,
            3.395967483520507812e-01,
            9.087462425231933594e-01,
            3.519758582115173340e-01,
            -3.025946393609046936e-02,
            3.290201127529144287e-01,
            9.834907054901123047e-01,
            -6.617969274520874023e-01,
            9.980736970901489258e-01,
            -6.723606586456298828e-01,
            -5.398578569293022156e-02,
            1.038217186927795410e+00,
            8.733372092247009277e-01,
            1.807491183280944824e-01,
            2.281174212694168091e-01,
            6.580746769905090332e-01,
            5.127957463264465332e-01,
            -2.033953070640563965e-01,
            6.195079684257507324e-01,
            6.332688331604003906e-01
        ]
        self.b2 = [
            3.659463524818420410e-01,
            6.926713585853576660e-01,
            5.392223596572875977e-01,
            2.911652624607086182e-01,
            6.384406089782714844e-01,
            1.027305483818054199e+00,
            -9.453436732292175293e-02,
            -4.747006669640541077e-02,
            7.096756696701049805e-01,
            -3.863164782524108887e-01,
            8.854064345359802246e-01,
            3.361816704273223877e-02,
            7.238855361938476562e-01,
            1.595986932516098022e-01,
            1.516269743442535400e-01,
            2.458983361721038818e-01,
            8.205094933509826660e-01,
            -1.106521561741828918e-01,
            9.006786346435546875e-01,
            -6.771483272314071655e-02,
            -1.965225934982299805e-01,
            -1.486665755510330200e-02,
            7.384046316146850586e-01,
            3.194152712821960449e-01,
            4.360660612583160400e-01,
            4.450093805789947510e-01,
            3.765302300453186035e-01,
            3.372497856616973877e-01,
            9.086159467697143555e-01,
            7.117593288421630859e-01,
            -1.280720472335815430e+00,
            -9.428265690803527832e-02,
            7.331714034080505371e-02,
            -3.111628629267215729e-02,
            8.059026300907135010e-02,
            7.349340915679931641e-01,
            6.054078340530395508e-01,
            -2.201380282640457153e-01,
            -1.570564508438110352e-01,
            -4.549055993556976318e-01
        ]
        self.b3 = [1.278471201658248901e-01]

        # self.net = NNet(self.w1, self.w2, self.w3, self.b1, self.b2, self.b3)
        self.perc = MapcalcPerceptron([self.w1, self.w2, self.w3], [self.b1, self.b2, self.b3])

 
    def make_cloud(self, input_list, output):
        # import ipdb; ipdb.set_trace()
        expr = self.perc.output(input_list, output)
        r.mapcalc(expression=expr)


def main(input, output, outdir, grass_params):
    out_file = os.path.join(outdir, output)
    PERMANENT = Session()
    PERMANENT.open(gisdb=grass_params[0], location=grass_params[1], mapset=grass_params[2])

    in_rast = uniq_name()
    out_rast = uniq_name()
    detector = CloudDetector()

    try:
        r.external(input=input, output=in_rast)

        g.region(raster=band_name(in_rast, 'B1'))
        bands = ["B1", "B2", "B4", "B5", "B8", "B8A", "B9", "B10", "B11", "B12"]
        bands = [band_name(in_rast, b) for b in bands]

        # Rescale bands to [0, 1]
        scaled = [uniq_name() for _ in bands]
        for t, b in zip(scaled, bands):
            r.mapcalc(expression='%s = %s / 10000.0' % (t, b))

        detector.make_cloud(scaled, [out_rast])

        r.out_gdal(input=out_rast, output=out_file, createopt='COMPRESS=DEFLATE')
    finally:
        g.remove(type='raster', pattern='%s*' % (in_rast), flags='f')
        g.remove(type='raster', name=output, flags='f')
        for t in scaled:
            g.remove(type='raster', name=t, flags='f')
    

    PERMANENT.close()



if __name__ == "__main__":
    from config import DATA, LOCATION, MAPSET

    parser = argparse.ArgumentParser(description='Detect clouds.')
    parser.add_argument('input', help='Sentinel-2 image')
    parser.add_argument('outfile', help='Name of output raster with pobabilities (percents)')
    parser.add_argument('outdir', help='Name of output directory for rasters')
    # parser.add_argument('grassdata', help='GRASSDATA directory (e.g. /opt/GRASSDATA)')
    # parser.add_argument('location', help='LOCATION directory (e.g. LatLon)')
    # parser.add_argument('mapset', help='MAPSET directory (e.g. PERMANENT)')

    args = parser.parse_args()
    input = args.input
    outdir = args.outdir
    outfile = args.outfile
    main(input, outfile, outdir, (DATA, LOCATION, MAPSET))

